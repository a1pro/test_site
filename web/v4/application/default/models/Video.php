<?php
/**
 * Class represents records from table files
 * "path" field may contain numeric id - from the uploads table
 * {autogenerated}
 * @property int $video_id 
 * @property string $title 
 * @property string $desc 
 * @property string $path 
 * @property int $size 
 * @property string $display_type 
 * @property datetime $dattm 
 * @property bool $hide 
 * @see Am_Table
 */
class Video extends ResourceAbstract {
    /** @var Upload */
    private $_upload;
    public function getAccessType()
    {
        return ResourceAccess::VIDEO;
    }
    function getDisplayFilename()
    {
        return ($this->path>0 && $u=$this->getUpload()) ?
            $u->getName() :
            $this->path;
    }
    function getFullPath()
    {
        return ($this->path>0 && $u=$this->getUpload()) ?
            $u->getFullPath() :
            $this->path;
    }
    /** @return Upload|null */
    function getUpload()
    {
        if ($this->_upload && $this->_upload->upload_id == $this->path)
            return $this->_upload;
        return ($this->path > 0) ? $this->_upload = $this->getDi()->uploadTable->load($this->path) : null;
    }
    public function getUrl()
    {
        return REL_ROOT_URL . "/video/p/id/" . $this->video_id;
    }
    function isExists()
    {
        return file_exists($this->getFullPath());
    }
    function getSize()
    {
        return filesize($this->getFullPath());
    }
    function getName()
    {
        $upload = $this->getUpload();
        return $upload ? $upload->getName() : $this->title;
    }
}

class VideoTable extends ResourceAbstractTable {
    protected $_key = 'video_id';
    protected $_table = '?_video';
    protected $_recordClass = 'Video';
}
